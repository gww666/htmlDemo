<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        #box {
            margin: 0 auto;
        }
        .item {
            /*width: 200px;*/
            float: left;
            border: 1px solid #ccc;
            padding: 5px;
            margin: 5px;
        }

        .item img {
            width: 200px;
        }

        
    </style>
    <script src="../Utils.js"></script>
    <script>
        
        
        onload = onresize = layout;
        var width;
        var height;
        var box;
        var items;
        function layout() {
            width = window.innerWidth;
            height = window.innerHeight;
            box = $("box");
            items = document.getElementsByClassName("item");
            var column = parseInt(width / (items[0].offsetWidth + 10));
            box.style.width = column * items[0].offsetWidth + column * 10 + "px";
            var firstRow = [];
            function Item(l, h) {
                this.left = l;
                this.height = h;
            }
            // console.log(width);
            // console.log(column);
            // console.log(items[0].offsetWidth);

            for (var i = 0; i < items.length; i ++) {
                if (i < column) {
                    items[i].style.position = "static";
                    // console.log(items[i].offsetLeft);
                    // console.log(items[i].offsetHeight);
                    console.log(items[i].offsetLeft);
                    firstRow.push(new Item(items[i].offsetLeft, items[i].offsetHeight));
                    
                } else {
                    var minIndex = 0; //第一排最小高度图片的下标
                    var tempHeight = firstRow[0].height; //中间变量
                    // console.log(firstRow[0].height);
                    //获取到第一排图片的最小高度
                    // console.log(firstRow.length);
                    for (var j = 0; j < firstRow.length; j++) {
                        if (tempHeight > firstRow[j].height) {
                            tempHeight = firstRow[j].height;
                            minIndex = j;
                        }
                    }
                    items[i].style.position = "absolute";
                    items[i].style.left = firstRow[minIndex].left - 5 + "px";
                    items[i].style.top = firstRow[minIndex].height + 10 + "px";
                    firstRow[minIndex].height = firstRow[minIndex].height + items[i].offsetHeight + 10;
                }
            }
            
        }

        onscroll = function () {
            // layout();
            // console.log("dd");
            var box = $("box");
            var items = document.getElementsByClassName("item");
            var scrollTop = document.body.scrollTop;
            //获取最后一个元素的底部位置
            var lastHeight = items[items.length - 1].offsetTop + items[items.length - 1].offsetHeight;
            if (lastHeight <= scrollTop + height) {
                for (var i = 1; i < 31; i++) {
                    var div = document.createElement("div");
                    div.innerHTML = "<img src='images1/img (" + i + ").jpg' />";
                    div.className = "item";
                    box.appendChild(div);
                }
                layout();
            }
            
        }
    </script>
</head>

<body>
    <div id="box">
        <div class="item"> <img src="images1/img (1).jpg" /> </div>
        <div class="item"> <img src="images1/img (2).jpg" /> </div>
        <div class="item"> <img src="images1/img (3).jpg" /> </div>
        <div class="item"> <img src="images1/img (4).jpg" /> </div>
        <div class="item"> <img src="images1/img (5).jpg" /> </div>
        <div class="item"> <img src="images1/img (6).jpg" /> </div>
        <div class="item"> <img src="images1/img (7).jpg" /> </div>
        <div class="item"> <img src="images1/img (8).jpg" /> </div>
        <div class="item"> <img src="images1/img (9).jpg" /> </div>
        <div class="item"> <img src="images1/img (10).jpg" /> </div>
        <div class="item"> <img src="images1/img (11).jpg" /> </div>
        <div class="item"> <img src="images1/img (12).jpg" /> </div>
        <div class="item"> <img src="images1/img (13).jpg" /> </div>
        <div class="item"> <img src="images1/img (14).jpg" /> </div>
        <div class="item"> <img src="images1/img (15).jpg" /> </div>
        <div class="item"> <img src="images1/img (16).jpg" /> </div>
        <div class="item"> <img src="images1/img (17).jpg" /> </div>
        <div class="item"> <img src="images1/img (18).jpg" /> </div>
        <div class="item"> <img src="images1/img (19).jpg" /> </div>
        <div class="item"> <img src="images1/img (20).jpg" /> </div>
        <div class="item"> <img src="images1/img (21).jpg" /> </div>
        <div class="item"> <img src="images1/img (22).jpg" /> </div>
        <div class="item"> <img src="images1/img (23).jpg" /> </div>
        <div class="item"> <img src="images1/img (24).jpg" /> </div>
        <div class="item"> <img src="images1/img (25).jpg" /> </div>
        <div class="item"> <img src="images1/img (26).jpg" /> </div>
        <div class="item"> <img src="images1/img (27).jpg" /> </div>
        <div class="item"> <img src="images1/img (28).jpg" /> </div>
        <div class="item"> <img src="images1/img (29).jpg" /> </div>
        <div class="item"> <img src="images1/img (30).jpg" /> </div>
        <div class="item"> <img src="images1/img (31).jpg" /> </div>
    </div>
</body>

</html>